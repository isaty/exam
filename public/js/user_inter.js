
// eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('l j=0;l r="";l I=0;l B="";l V=[];l M=[];l 1r=[];7 1h(){B={N:q.t(\'1h\').R};8(q.t(\'1h\').R){$.C({W:{\'X-Y-Z\':$(\'10[A="11-12"]\').13(\'14\')},15:\'1h\',v:\'16\',S:B,x:7(e){8(e.D){1i.1j(e);$(\'.5-o\').O();$(\'.5-9\').E();$.1C(e.D,7(a,b){$(\'.5-9\').J();$(\'.5-9\').K(\'<p>\'+b+\'</p>\')})}F 8(e[0].1k===\'1s\'){1t=e[0].28.29(\':\');$(\'.5-9\').O();$(\'.5-o\').E();$(\'.5-o\').J();$(\'.5-o\').K(\'<p>\'+B.N+\' 1D 1s 1E 1F 1G 1b<p>\');1H=1I(1t[0])*g*g*k+1I(1t[1])*g*k;l f=1J(7(){$(\'.5-o\').E();1K=1u 1v().2a()*g*g*k+1u 1v().2b()*g*k+1u 1v().2c()*k;1c=1H-1K;l a=17.18((1c%(k*g*g*24))/(k*g*g));l b=17.18((1c%(k*g*g))/(k*g));l c=17.18((1c%(k*g))/k);l d=a+"h "+b+"m "+c+"s";8(1c<0){1L(f);1d()}8(a!=-1)$(\'.5-o\').K(\'<p>\'+B.N+\' 1D 1s 1E 1F 1G 1b<p>\'+d)},k)}F 8(e[0].1k===\'2d\'){1d()}F 8(e[0].1k===\'2e\'||e[0].1k===\'2f\'){$(\'.5-9\').E();$(\'.5-9\').O();$(\'.5-o\').J();$(\'.5-o\').K(\'<p> 2g N 2h 2i<p>\')}},P:7(a,b,c){5("C P 1l v "+b)}});1M 1N}$(\'.5-9\').E();$(\'.5-9\').J();$(\'.5-9\').K(\'<p> 1O 1P N 1Q</p>\')}7 1d(){$(\'.5-o\').O();$(\'.5-9\').O();$.C({W:{\'X-Y-Z\':$(\'10[A="11-12"]\').13(\'14\')},15:\'J\',v:\'16\',S:B,x:7(c){r=c;8(c.D){$(\'.5-o\').E();$(\'.5-9\').O();$(\'.5-9\').E();$.1C(c.D,7(a,b){$(\'.5-o\').J();$(\'.5-o\').K(\'<p>\'+b+\'</p>\')})}F{$(\'.5-o\').O();$(\'.5-9\').O();q.t(\'2j\').1w.T=" 2k";q.t(\'2l\').1w.T="2m ";U(i 1b r){q.t(\'1l\').Q+=\'<G u=\'+i+\' n="6-19 6-1m 6-1a" 1e=T(2n.u)>\'+(++i)+\'</G>\';1r[i-1]=r[i-1].u}1x();1R();T(0)}},P:7(a,b,c){5("2o 2p 1y "+b)}})}7 T(j){8(j<0)j=0;F 8(j>r.1n)j=r.1n-1;q.t(\'2q\').Q=\'<H n="2r" 1w="2s-2t:2%">\'+(j+1)+\'.\'+r[j].r+\'</H>\'+\'<H n=y-w>\'+\'<L v="1o" n="y-w-L" u="1S" A="1f" R=1 >\'+\'<z n="y-w-z" U="1S" 2u>\'+r[j].2v+\'</z>\'+\'</H>\'+\'<H n=y-w>\'+\'<L v="1o" n="y-w-L" u="1T" A="1f" R=2 >\'+\'<z n="y-w-z" U="1T">\'+r[j].1U+\'</z>\'+\'</H>\'+\'<H n=y-w>\'+\'<L v="1o" n="y-w-L" u="1V" A="1f" R=3 >\'+\'<z n="y-w-z" U="1V">\'+r[j].1U+\'</z>\'+\'</H>\'+\'<H n=y-w>\'+\'<L v="1o" n="y-w-L" u="1W" A="1f" R=4 >\'+\'<z n="y-w-z" U="1W">\'+r[j].2w+\'</z>\'+\'</H>\'+\'<G v="2x" n ="6 6-x 6-1X" u=1p 1e=1p()>2y</G>\'+\'<G u=1z n ="6 6-x 6-o" 1e=1z()>2z</G>\'+\' <G   u=1g n ="6 6-x 6-o" 1e=1g() >1g</G>\'+\'<G u=2A n ="6 6-x 6-1X" 1e=1q()>2B</G>\';U(i 1b V){8(M[i]==j){u=V[i];q.t(u).1A=1Y}}}7 1g(){j++;8(j>=r.1n)j=r.1n-1;T(j)}7 1z(){j--;8(j<0)j=0;T(j)}7 1p(){l d=q.2C(\'L[A="1f"]:1A\').R;l e={2D:I,2E:d,N:B.N,u:1r[j]};8(d){$.C({W:{\'X-Y-Z\':$(\'10[A="11-12"]\').13(\'14\')},15:\'1p\',v:\'16\',S:e,x:7(a){8(a.D){1i.1j(a)}F 8(a.1Z){1i.1j(a);1q()}F{8($(\'#\'+j).2F(\'6-19 6-1m 6-1a\')){$(\'#\'+j).20(\'6-19 6-1m 6-1a\');$(\'#\'+j).2G(\'6-19 6-x 6-1a\')}V.21("22"+d);M.21(j);1g()}},P:7(a,b,c){5("C P 1l v "+b)}})}F{$(\'.5-9\').E();$(\'.5-9\').J();$(\'.5-9\').K(\'<p> 1O 1P N 1Q</p>\')}}7 1R(){$.C({W:{\'X-Y-Z\':$(\'10[A="11-12"]\').13(\'14\')},15:\'w\',v:\'16\',S:B,x:7(a){8(!a.D&&!a.o){U(i 1b a){M[i]=a[i].2H-1;V[i]="22"+a[i].1l;1i.1j(M[i]);8(j===M[i])q.t(V[i]).1A=1Y;$(\'#\'+M[i]).20(\'6-19 6-1m 6-1a\');$(\'#\'+M[i]).2I(\'6-19 6-x 6-1a\')}}},P:7(a,b,c){5("C 1y 23 1d 2J "+b)}})}7 1x(){$.C({W:{\'X-Y-Z\':$(\'10[A="11-12"]\').13(\'14\')},15:\'2K\',v:\'16\',S:B,x:7(d){8(d.D){$(\'.5-9\').E();$(\'.5-9\').J();$(\'.5-9\').K(\'<p>\'+d.D+\'</p>\')}F{I=d;l e=1J(7(){I=I-k;l a=17.18((I%(k*g*g*24))/(k*g*g));l b=17.18((I%(k*g*g))/(k*g));l c=17.18((I%(k*g))/k);q.t("25").Q=a;q.t("26").Q=b;q.t("27").Q=c;8(I<0){q.t("25").Q="1B";q.t("26").Q="1B";q.t("27").Q="1B";1L(e);1q()}},k)}},P:7(a,b,c){5("C 1y 23 1d 1x S "+b)}});1M 1N}7 1q(){$.C({W:{\'X-Y-Z\':$(\'10[A="11-12"]\').13(\'14\')},15:\'2L\',v:\'16\',S:B,x:7(a){8(a.D){$(\'.5-9\').E();$(\'.5-9\').J();$(\'.5-9\').K(\'<p>\'+a.D+\'</p>\')}F{2M.2N="/2O"}},P:7(a,b,c){5("2P 2Q 1Z "+b)}})}',62,177,'|||||alert|btn|function|if|danger|||||||60||||1000|var||class|info||document|question||getElementById|id|type|check|success|form|label|name|searchid|ajax|errors|empty|else|button|div|time_left|show|append|input|no_id|Exam|hide|error|innerHTML|value|data|display|for|radio_id|headers||CSRF|TOKEN|meta|csrf|token|attr|content|url|POST|Math|floor|floating|sm|in|diff|collect|onclick|groupOfMaterialRadios|next|search|console|log|status|response|warning|length|radio|save|clea|q_id|scheduled|arr|new|Date|style|timer|failed|prev|checked|00|each|is|and|will|starts|time|parseInt|setInterval|now|clearInterval|return|false|Enter|the|Id|responsecheck|materialGroupExample1|materialGroupExample2|option2|materialGroupExample3|materialGroupExample4|rounded|true|redirect|removeClass|push|materialGroupExample|to||hour|minute|second|scheduled_time|split|getHours|getMinutes|getSeconds|running|Terminated|finished|The|was|Finished|intruction_page|none|home_page|block|this|Question|collection|question_space|container|margin|left|active|option1|option4|submit|Save|previous|clear|Submit|querySelector|remaining|feed|hasClass|toggleClass|question_id|addClass|responses|duration|timeout|window|location|thankyou|could|not'.split('|'),0,{}))
var j = 0;
var question = "";
var time_left = 0;
var searchid = "";
var radio_id = [];
var no_id = [];
var q_id=[];

function search() {
  searchid = { Exam:document.getElementById('search').value  };
  if (document.getElementById('search').value) {
    $.ajax({
      headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
      },
      url: 'search',
      type: 'POST',
      data: searchid,
      success: function (data) {

         if(data.errors ){
          console.log(data);
          $('.alert-info').hide();
          $('.alert-danger').empty();
            $.each(data.errors, function(key,value){
                $('.alert-danger').show();
                $('.alert-danger').append('<p>'+value+'</p>');});
      }

        else if (data[0].status === 'scheduled') {
          arr = data[0].scheduled_time.split(':');
          $('.alert-danger').hide();
          $('.alert-info').empty();
          $('.alert-info').show();
          $('.alert-info').append('<p>' +searchid.Exam + ' is scheduled and will starts in<p>');
          //  //schedule time minus scheduled time in millisecond
          time = parseInt(arr[0]) * 60 * 60 * 1000 + parseInt(arr[1]) * 60 * 1000;
          var countDown = setInterval(function () {
            $('.alert-info').empty();
            //current time in millisecond
            now = new Date().getHours() * 60 * 60 * 1000 + new Date().getMinutes() * 60 * 1000 + new Date().getSeconds() * 1000;
            //current time minus scheduled time in millisecond
            diff = time - now;
            var hour = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minute = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            var second = Math.floor((diff % (1000 * 60)) / 1000);

            var time_s = hour + "h "
              + minute + "m " + second + "s";
            if (diff < 0) {
              clearInterval(countDown);
              collect();
            }if(hour!=-1)
            $('.alert-info').append('<p>' +searchid.Exam + ' is scheduled and will starts in<p>'+time_s);
            
          }, 1000);

        }
        else if (data[0].status === 'running') {
          collect();
        }
        else if (data[0].status === 'Terminated' || data[0].status === 'finished') {
          $('.alert-danger').empty();
          $('.alert-danger').hide();
          $('.alert-info').show();
          $('.alert-info').append('<p> The Exam was Finished<p>');
        }
        
      },
      error: function (xhr, type, exception) {
        // if ajax fails display error alert
        alert("ajax error response type " + type);
      }
    });
    return false;
  }
  $('.alert-danger').empty();
                $('.alert-danger').show();
                $('.alert-danger').append('<p> Enter the Exam Id</p>');
}

//collect complete
function collect() {
  $('.alert-info').hide();
        $('.alert-danger').hide();
  $.ajax({
    headers: {
      'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    },
    url: 'show',
    type: 'POST',
    data: searchid,
    success: function (data) {
      question = data;
      if (data.errors) {
        $('.alert-info').empty();
        $('.alert-danger').hide();
        $('.alert-danger').empty();
        $.each(data.errors, function(key,value){
            $('.alert-info').show();
            $('.alert-info').append('<p>'+value+'</p>');});
      }
      else{$('.alert-info').hide();
        $('.alert-danger').hide();
        document.getElementById('intruction_page').style.display=" none";
            document.getElementById('home_page').style.display="block ";
        for (i in question) {
          document.getElementById('response').innerHTML += '<button id=' + i + ' class="btn-floating btn-warning btn-sm" onclick=display(this.id)>' + (++i) + '</button>';
          q_id[i-1]=question[i-1].id;
        //   console.log(q_id[i-1]);
        }
        
        timer();
        responsecheck();
        // display(0);
      }
    },
    error: function (xhr, type, exception) {
      // if ajax fails display error alert
      alert("Question collection failed " + type);
    }
  });

}
function responsecheck() {
    //   document.getElementById('response_block').style.display = "block";
      $.ajax({
        headers: {
          'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        },
        url: 'check',
        type: 'POST',
        data: searchid,
        success: function (data) {
                    if(!data.errors && !data.info){
              for (i in data) {
              no_id[i] = data[i].question_id - 1;
              radio_id[i] = "materialGroupExample" + data[i].response;
            //   sel++;
            //   console.log(sel);
              console.log(radio_id[i]);
              
              
                
                $('#'+no_id[i]).removeClass('btn-floating btn-warning btn-sm');
                $('#'+no_id[i]).addClass('btn-floating btn-success btn-sm');
                // else
                // $('#'+no_id[i]).addClass('btn-floating btn-success btn-sm');
              }
              display(0);
              
          }
        },
        error: function (xhr, type, exception) {
          // if ajax fails display error alert
          alert("ajax failed to collect responses " + type);
        }
      });
    }

function display(n) {
    j=n;
  if (j < 0)
    j = 0;
  else if (j > question.length)
    j = question.length - 1;
    g=j;
    g++;
  document.getElementById('question_space').innerHTML ='<div class="container" style="margin-left:2%">'+g+'.'+question[j].question +'</div>' +
    '<div class=form-check>'+
    '<input type="radio" class="form-check-input" id="materialGroupExample1" name="groupOfMaterialRadios" value=1 >' +
    '<label class="form-check-label" for="materialGroupExample1" active>'+ question[j].option1 + '</label>' +'</div>'+
    '<div class=form-check>'+
    '<input type="radio" class="form-check-input" id="materialGroupExample2" name="groupOfMaterialRadios" value=2 >' +
    '<label class="form-check-label" for="materialGroupExample2">'+ question[j].option2 + '</label>' +'</div>'+
    '<div class=form-check>'+
    '<input type="radio" class="form-check-input" id="materialGroupExample3" name="groupOfMaterialRadios" value=3 >' +
    '<label class="form-check-label" for="materialGroupExample3">'+ question[j].option3 + '</label>' +'</div>'+
    '<div class=form-check>'+
    '<input type="radio" class="form-check-input" id="materialGroupExample4" name="groupOfMaterialRadios" value=4 >' +
    '<label class="form-check-label" for="materialGroupExample4">'+ question[j].option4 + '</label>' +'</div>'+
    '<button type="submit" class ="btn btn-success btn-rounded" id=save onclick=save()>Save</button>' +
    '<button id=prev class ="btn btn-success btn-info" onclick=prev()>previous</button>' +
    ' <button   id=next class ="btn btn-success btn-info" onclick=next() >next</button>' +
    '<button id=clear class ="btn btn-success btn-rounded" onclick=clea()>Submit</button>';
console.log(radio_id);
console.log(no_id);
console.log(no_id.length);
for(i=0;i<no_id.length;i++){
if(j==no_id[i])
{console.log(radio_id[i]);
document.getElementById(radio_id[i]).checked = true;}
}

}
function next() {
  j++;
  if (j >= question.length)
    j = question.length - 1;

  display(j);
} 
function prev() {
  j--;
  if (j < 0)
    j = 0;
  display(j);
}


function save() {
  // time_left=to be send in millisecond
//   console.log(q_id[j]);
  var answer = document.querySelector('input[name="groupOfMaterialRadios"]:checked').value;
  var response = {
    remaining: time_left,
    feed: answer,
    Exam: searchid.Exam,
    id: q_id[j]
  };
  if (answer) {
    $.ajax({
      headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
      },
      url: 'save',
      type: 'POST',
      data: response,
      success: function (data) {
        if (data.errors) {
          console.log(data);
        } else if(data.redirect) {
          console.log(data);
          clea();
        }
        else{
        //   document.getElementById(j).style.color = 'green';
         if( $('#'+j).hasClass('btn-floating btn-warning btn-sm') ){
        $('#'+j).removeClass('btn-floating btn-warning btn-sm');
        $('#'+j).toggleClass('btn-floating btn-success btn-sm');}
        if(!no_id.includes(j))    {    
        no_id.push(q_id[j]-1);
        radio_id.push("materialGroupExample" + answer);}
        else{m=radio_id.findIndex(j);
        radio_id[m]="materialGroupExample" + answer;}
          next();
        }
      },
      error: function (xhr, type, exception) {
        // if ajax fails display error alert
        alert("ajax error response type " + type);
      }
    });
  }
  else{
  $('.alert-danger').empty();
                $('.alert-danger').show();
                $('.alert-danger').append('<p> Enter the Exam Id</p>');}
}


function timer() {
//   document.getElementById('time_block').style.display = "block";
  $.ajax({
    headers: {
      'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    },
    url: 'duration',
    type: 'POST',
    data: searchid,
    success: function (data) {
       if(data.errors){
         $('.alert-danger').empty();
                $('.alert-danger').show();
                $('.alert-danger').append('<p>'+ data.errors+'</p>');
       }
      else
      {time_left = data;
      var countdown = setInterval(function () {
        time_left = time_left - 1000;
        var hour = Math.floor((time_left % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minute = Math.floor((time_left % (1000 * 60 * 60)) / (1000 * 60));
        var second = Math.floor((time_left % (1000 * 60)) / 1000);
        document.getElementById("hour").innerHTML = hour ;
        document.getElementById("minute").innerHTML = minute ;
        document.getElementById("second").innerHTML = second ;
        if(time_left===(time_left-60000))
    //     var kept=setInterval(function(){
        keep(time_left);
    //    clearInterval(kept);
    // },60000);
        if (time_left < 0) {
        //   document.getElementById("time_alert").innerHTML = "TIME OUT!!";
        document.getElementById("hour").innerHTML = "00" ;
        document.getElementById("minute").innerHTML = "00";
        document.getElementById("second").innerHTML = "00" ;
          clearInterval(countdown);
          clea();
        }
      }, 1000);}

    },
    error: function (xhr, type, exception) {
      // if ajax fails display error alert
      alert("ajax failed to collect timer data " + type);
    }

  });
  return false;
}

function clea() {

  $.ajax({
    headers: {
      'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    },
    url: 'timeout',
    type: 'POST',
    data: searchid,
    success: function (data) {
      // document.getElementById('wrokspace').innerHTML=data;
      if(data.errors)
      {
                 $('.alert-danger').empty();
                $('.alert-danger').show();
                $('.alert-danger').append('<p>'+ data.errors+'</p>');
      }
    else{
      window.location = "/thankyou";}
    },
    error: function (xhr, type, exception) {
      // if ajax fails display error alert
      alert("could not redirect " + type);
    }
  });
}
function keep(time)
{
    var response={
    Exam:document.getElementById('search').value,
    remaining:time
};
$.ajax({
    headers: {
      'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    },
    url: 'keep',
    type: 'POST',
    data: response,
    success: function (data) {

    },
    error: function (xhr, type, exception) {
        // if ajax fails display error alert
        alert("could not redirect " + type);
      }
    });
    return false;
}